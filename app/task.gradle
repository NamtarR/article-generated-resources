import groovy.json.JsonSlurper
import groovy.xml.MarkupBuilder

task generateStringsFile {

    def inputFile = project.rootProject.file("input_file.json")
    def outputFile = project.file("build/generated/res/res-task/main/values/strings.xml")

    doLast {
        outputFile.parentFile.mkdirs()

        outputFile.withWriter("UTF-8") { writer ->
            def json = new JsonSlurper().parseText(inputFile.text)
            def xml = new MarkupBuilder(new IndentPrinter(writer, "    ", true, true))
            def mkp = xml.getMkp()

            xml.setDoubleQuotes(true)
            mkp.xmlDeclaration(version: "1.0", encoding: "utf-8")
            mkp.comment("Generated at ${new Date()}")
            mkp.yield "\r\n"

            xml.resources {
                json.each { key, value ->
                    string(name: key) { mkp.yield(value) }
                }
            }
        }
    }
}